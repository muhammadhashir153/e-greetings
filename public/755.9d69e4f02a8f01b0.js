"use strict";(self.webpackChunkMatdash=self.webpackChunkMatdash||[]).push([[755],{7755:(V,P,c)=>{c.d(P,{x:()=>R});var b=c(8834),h=c(1669),m=c(9417),C=c(2798),g=c(2102),_=c(5596),S=c(9631),E=c(2765),j=c(5951),k=c(1413),x=c(177),t=c(3953),I=c(7816),y=c(4710),T=c(1966),O=c(1626);let w=(()=>{class s{constructor(n){this.http=n,this.apiUrl="http://greetify.somee.com/api/CardMedias"}createMedia(n){return this.http.post(this.apiUrl,n)}getAllMedia(){return this.http.get(this.apiUrl)}getMediaById(n){return this.http.get(`${this.apiUrl}/${n}`)}updateMedia(n,a){return this.http.put(`${this.apiUrl}/${n}`,a)}static{this.\u0275fac=function(a){return new(a||s)(t.KVO(O.Qq))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),U=(()=>{class s{constructor(n){this.http=n,this.apiUrl="http://greetify.somee.com/api/Transactions"}addEmail(n){return this.http.post(this.apiUrl,n)}static{this.\u0275fac=function(a){return new(a||s)(t.KVO(O.Qq))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var A=c(6600);const B=(s,u)=>u.value;function $(s,u){1&s&&(t.j41(0,"p",52),t.EFF(1,"Nothing to see? start uploading then\u{1f590}"),t.k0s())}function N(s,u){if(1&s&&(t.j41(0,"mat-option",30),t.EFF(1),t.k0s()),2&s){const n=u.$implicit;t.Y8G("value",n.value),t.R7$(),t.JRh(n.viewValue)}}let R=(()=>{class s{constructor(n,a,i,e,o,r,d){this.tempService=n,this.activeRoute=a,this.CustomTempService=i,this.mediaSer=e,this.fb=o,this.emailSer=r,this.router=d,this.id=null,this.desc$=new k.B,this.img$=new k.B,this.disabledSave=!0,this.undoStack=[],this.redoStack=[],this.userMedia=null,this.fonts=[{value:"times-new-roman",viewValue:"Times New Roman"},{value:"arial",viewValue:"Arial"},{value:"Verdana",viewValue:"Verdana"},{value:"Georgia",viewValue:"Georgia"}],this.selectedFont=this.fonts[1].value}ngOnInit(){this.id=this.activeRoute.snapshot.paramMap.get("id"),this.tempService.getServiceById(this.id).subscribe(n=>{this.temp=n;const i=this.temp.description;this.img$.next(this.temp.imageUrl),this.desc$.next(i)}),this.emailForm=this.fb.group({email:["",[m.k0.required,m.k0.email]]})}saveStateForStack(){if(this.canvas){const n=JSON.stringify(this.canvas.toJSON());0===this.undoStack.length||this.undoStack[this.undoStack.length-1]!==n?(this.undoStack.push(n),console.log("State saved")):console.log("State is identical to the previous one, not saving.")}else console.log("Canvas not initialized")}undo(){if(this.undoStack.length>0){console.log("Undo Stack Before:",this.undoStack.length);const n=JSON.stringify(this.canvas.toJSON());this.redoStack.push(n),this.disabledSave=!1;const a=this.undoStack.pop();console.log("Undo Stack After:",this.undoStack.length),this.canvas.loadFromJSON(a,()=>{this.canvas.renderAll(),this.disabledSave=!0})}else 1===this.undoStack.length?alert("No more actions to undo"):alert("Undo stack is empty")}redo(){if(this.redoStack.length>0){let n=JSON.stringify(this.canvas.toJSON());this.undoStack.push(n),this.disabledSave=!1;const a=this.redoStack.pop();console.clear(),console.log(a),this.canvas.loadFromJSON(a,()=>{this.canvas.renderAll(),this.disabledSave=!0})}else this.redoStack=[],alert("No more actions to redo")}ngAfterViewInit(){let n="",a="",i=document.getElementById("canvas-box");this.showMedia(),this.canvas=new h.fabric.Canvas("fabricCanvas");let e=this.canvas;setTimeout(()=>{i.style.width=getComputedStyle(i).width,this.canvas.setWidth(parseFloat(getComputedStyle(i).width))},0),this.desc$.subscribe(p=>{a=p;const l=new h.fabric.Textbox(a,{left:200,top:250,fontSize:40,fill:"#000",fontWeight:"bold",textAlign:"center",editable:!0,width:400});this.canvas.add(l),e.setActiveObject(l)}),this.img$.subscribe(p=>{n=p,h.fabric.Image.fromURL(n,l=>{const F=this.canvas.getWidth()||800,M=this.canvas.getHeight()||600,v=Math.min(F/l.width,M/l.height);l.scale(v),l.left=(F-l.width*v)/2,l.top=(M-l.height*v)/2,this.canvas.setBackgroundImage(l,this.canvas.renderAll.bind(this.canvas),{selectable:!1}),this.canvas.renderAll()})}),document.getElementById("add-text").onclick=function r(){const p=new h.fabric.Textbox("Enter text here",{left:50,top:50,width:200,fontSize:20,fontFamily:"Arial",fill:"#000",borderColor:"#333",cornerColor:"#333",cornerStyle:"circle",editable:!0});e.add(p),e.setActiveObject(p),e.renderAll()},window.addEventListener("localStorageUpdated",()=>{let p=localStorage.getItem("media");p&&h.fabric.Image.fromURL(p,l=>{l.scaleToWidth(200),l.scaleToHeight(200),l.set({hasBorders:!0,hasControls:!0}),this.canvas.add(l),e.setActiveObject(l),this.canvas.renderAll()})});const d=document.getElementById("del-item");function f(){const p=e.getActiveObject();if(p){const l=p.aCoords;l&&(d.style.left=`${l.tr.x}px`,d.style.top=l.tr.y-30+"px",d.style.display="block")}else d.style.display="none"}e.on("selection:created",f),e.on("selection:created",()=>{this.showPanel(null),this.disabledSave&&this.saveStateForStack()}),e.on("selection:cleared",f),e.on("selection:cleared",()=>{this.closePanel(),this.disabledSave&&this.saveStateForStack()}),e.on("selection:updated",f),e.on("selection:updated",()=>{this.showPanel(null),this.disabledSave&&this.saveStateForStack()}),e.on("object:moving",f),e.on("object:added",()=>{this.disabledSave&&this.saveStateForStack()}),e.on("object:modified",()=>{this.disabledSave&&this.saveStateForStack()}),e.on("object:removed",()=>{this.disabledSave&&this.saveStateForStack()}),d.addEventListener("click",()=>{const p=e.getActiveObject();p&&(e.remove(p),e.discardActiveObject(),e.renderAll(),localStorage.removeItem("media"),this.closePanel(),d.style.display="none")}),this.canvas.setHeight(600),this.canvas.renderAll(),document.querySelector(".canvas-container")}saveState(){const n=document.getElementById("save-loader"),a=this.canvas.toJSON(),i=sessionStorage.getItem("UserId"),e=this.id,o={tempId:e,userId:i,info:JSON.stringify(a)};setTimeout(()=>{n.style.display="inline-block"},300),this.CustomTempService.checkTemp(i,e).subscribe(r=>{this.CustomTempService.updateTemp(r.id,o).subscribe(d=>{d.status>=200&&d.status<=204?(alert("Canvas updated"),n.style.display="none"):alert("Canvas update failed")},d=>{console.error(d),alert("Error updating canvas")})},r=>{404===r.status||"No matching template found"===r.error?this.CustomTempService.postTemp(o).subscribe(d=>{d.status>=200&&d.status<=204?(alert("Canvas saved"),n.style.display="none"):alert("Canvas save failed")},d=>{console.error(d),alert("Error saving canvas")}):(console.error(r),alert("Error checking canvas template"))})}showPanel(n){const a=document.getElementById("main-panel"),i=document.querySelectorAll(".panel"),e=this.canvas.getActiveObject();if(a&&(a.style.display="none"),i.forEach(o=>{o.style.display="none"}),e&&!n){let o="";switch(e.type){case"textbox":o="text";break;case"image":o="media";break;case"rect":case"circle":case"triangle":o="shape";break;default:return void console.log("No matching panel for object type:",e.type)}i.forEach(r=>{r.classList.contains(o)&&(r.style.display="block")})}else e||console.log("No active object found");null!=n&&i.forEach(o=>{o.classList.contains(n)&&(o.style.display="block")})}closePanel(){const n=document.getElementById("main-panel"),a=document.querySelectorAll(".panel");n&&a&&(a.forEach(i=>{i.style.display="none"}),n.style.display="flex")}uploadFile(n){const a=n.target;a.files&&0!==a.files.length&&Array.from(a.files).forEach(e=>{const o=new FormData;o.append("UserId",sessionStorage.getItem("UserId")||"0"),o.append("File",e),this.mediaSer.createMedia(o).subscribe(r=>{console.log("Upload successful:",r),this.showMedia()},r=>{console.error("Upload failed:",r)})})}showMedia(){const n=document.getElementById("media");if(n){let a=sessionStorage.getItem("UserId");this.mediaSer.getAllMedia().subscribe(i=>{this.userMedia=i.filter(e=>e.userId==a),console.log(this.userMedia),this.userMedia?.forEach(e=>{const o=document.createElement("div");o.classList.add("col-lg-6"),o.innerHTML=`<img src="http://greetify.somee.com${e.mediaUrl}" class="w-100" style="cursor: pointer;" />`,n.appendChild(o);const r=o.querySelector("img");r&&r.addEventListener("click",()=>this.addToCanvas(`http://greetify.somee.com${e.mediaUrl}`))})})}}addToCanvas(n){h.fabric.Image.fromURL(n,a=>{a.scaleToWidth(300),a.scaleToHeight(300),this.canvas.add(a),this.canvas.renderAll()})}updateTextProp(n,a){if(this.canvas){let i=this.canvas.getActiveObject(),e=n;const o=a.value??a.target?.value;i?.set(e,"fontSize"==e?parseFloat(o):o),this.canvas.renderAll()}else console.log("No canvas found")}sendEmail(){const n={senderId:sessionStorage.getItem("UserId"),recipientEmail:this.emailForm.get("email")?.value,templateId:this.id,message:`Here is a gift card for you: http://localhost:4200/home/view-card/${sessionStorage.getItem("UserId")}/${this.id}`,sender:null,template:null};this.emailSer.addEmail(n).subscribe(a=>{this.saveState(),alert("Success"),this.router.navigate([`/home/view-card/${a.senderId}/${a.templateId}`])})}static{this.\u0275fac=function(a){return new(a||s)(t.rXU(I.a),t.rXU(y.nX),t.rXU(T.T),t.rXU(w),t.rXU(m.ok),t.rXU(U),t.rXU(y.Ix))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-editor"]],standalone:!0,features:[t.aNF],decls:100,vars:3,consts:[[1,"container-fluid"],[1,"row"],[1,"col-lg-4","bg-dark"],[1,"text-center","text-light","mb-3"],["id","main-panel",1,"row","text-light"],[1,"col-lg-6"],[1,"icon-box","text-center",3,"click"],[1,"text-primary","fas","fa-images"],["id","add-text",1,"icon-box","text-center",3,"click"],[1,"text-primary","fas","fa-font"],[1,"col-lg-12"],[2,"width","fit-content","margin","auto"],["mat-flat-button","","color","primary",1,"m-r-8",3,"click"],[1,"fas","fa-paper-plane"],["id","panels"],[1,"panel","media"],[1,"text-light","text-center"],[1,"file-option"],["for","add-media",1,"text-light"],[1,"fas","fa-file-image","text-primary"],[1,"text-center"],["type","file","id","add-media","accept","image/*,video/*",3,"change"],["id","media",1,"row"],["class","text-center text-light",4,"ngIf"],[1,"fas","fa-angle-left"],[1,"panel","text","text-light"],[1,"text-light"],[1,"f-w-600","m-b-8","d-block","text-light"],["appearance","fill",1,"w-100","text-light"],[3,"valueChange","selectionChange","value"],[3,"value"],["appearance","fill",1,"w-100"],["type","color","matInput","","name","","id","text-color","value","#000000",3,"change"],["type","color","matInput","","name","","id","bg-color","value","#fff",3,"change"],["appearance","fill","color","primary",1,"w-100"],["matInput","","type","text","value","40",3,"change"],[1,"panel","send","text-light"],[3,"ngSubmit","formGroup"],["matInput","","formControlName","email","required",""],["type","submit","mat-flat-button","","color","primary"],[1,"col-lg-8"],["id","action-btns"],[1,"btns"],["mat-flat-button","","color","accent",3,"click"],[1,"fas","fa-rotate-left"],[1,"fas","fa-rotate-right"],["mat-flat-button","","color","primary",3,"click"],["id","save-loader",1,"fas","fa-spinner",2,"display","none"],["id","canvas-box"],["id","fabricCanvas","height","600",2,"border","1px solid #000"],["id","del-item"],[1,"fas","fa-trash"],[1,"text-center","text-light"]],template:function(a,i){1&a&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),t.EFF(4,"Editor options"),t.k0s(),t.j41(5,"div",4)(6,"div",5)(7,"div",6),t.bIt("click",function(){return i.showPanel("media")}),t.j41(8,"h1"),t.nrm(9,"i",7),t.k0s(),t.j41(10,"p"),t.EFF(11,"Add Media"),t.k0s()()(),t.j41(12,"div",5)(13,"div",8),t.bIt("click",function(){return i.showPanel("text")}),t.j41(14,"h1"),t.nrm(15,"i",9),t.k0s(),t.j41(16,"p"),t.EFF(17,"Add Text"),t.k0s()()(),t.j41(18,"div",10)(19,"div",11)(20,"button",12),t.bIt("click",function(){return i.showPanel("send")}),t.nrm(21,"i",13),t.EFF(22," Send "),t.k0s()()()(),t.j41(23,"div",14)(24,"div",15)(25,"h4",16),t.EFF(26,"Media"),t.k0s(),t.j41(27,"div",17)(28,"label",18)(29,"h1"),t.nrm(30,"i",19),t.k0s(),t.j41(31,"p",20),t.EFF(32,"Upload Files"),t.k0s()(),t.j41(33,"input",21),t.bIt("change",function(o){return i.uploadFile(o)}),t.k0s()(),t.j41(34,"div",22),t.DNE(35,$,2,0,"p",23),t.k0s(),t.j41(36,"div",11)(37,"button",12),t.bIt("click",function(){return i.closePanel()}),t.nrm(38,"i",24),t.EFF(39," Back "),t.k0s()()(),t.j41(40,"div",25)(41,"h1",26),t.EFF(42,"Text"),t.k0s(),t.j41(43,"div",1)(44,"div",10)(45,"mat-label",27),t.EFF(46,"Font Family"),t.k0s(),t.j41(47,"mat-form-field",28)(48,"mat-select",29),t.mxI("valueChange",function(o){return t.DH7(i.selectedFont,o)||(i.selectedFont=o),o}),t.bIt("selectionChange",function(o){return i.updateTextProp("fontFamily",o)}),t.Z7z(49,N,2,2,"mat-option",30,B),t.k0s()()(),t.j41(51,"div",5)(52,"mat-label",27),t.EFF(53,"Text Color"),t.k0s(),t.j41(54,"mat-form-field",31)(55,"input",32),t.bIt("change",function(o){return i.updateTextProp("fill",o)}),t.k0s()()(),t.j41(56,"div",5)(57,"mat-label",27),t.EFF(58,"Background Color"),t.k0s(),t.j41(59,"mat-form-field",31)(60,"input",33),t.bIt("change",function(o){return i.updateTextProp("backgroundColor",o)}),t.k0s()()(),t.j41(61,"div",10)(62,"mat-label",27),t.EFF(63,"Font Size"),t.k0s(),t.j41(64,"mat-form-field",34)(65,"input",35),t.bIt("change",function(o){return i.updateTextProp("fontSize",o)}),t.k0s()()()(),t.j41(66,"div",11)(67,"button",12),t.bIt("click",function(){return i.closePanel()}),t.nrm(68,"i",24),t.EFF(69," Back "),t.k0s()()(),t.j41(70,"div",36)(71,"h1",26),t.EFF(72,"Send"),t.k0s(),t.j41(73,"form",37),t.bIt("ngSubmit",function(){return i.sendEmail()}),t.j41(74,"mat-form-field",31)(75,"mat-label"),t.EFF(76,"Email"),t.k0s(),t.nrm(77,"input",38),t.k0s(),t.j41(78,"button",39),t.EFF(79,"Send"),t.k0s()(),t.j41(80,"div",11)(81,"button",12),t.bIt("click",function(){return i.closePanel()}),t.nrm(82,"i",24),t.EFF(83," Back "),t.k0s()()()()(),t.j41(84,"div",40)(85,"div",41)(86,"div",42)(87,"button",43),t.bIt("click",function(){return i.undo()}),t.nrm(88,"i",44),t.EFF(89," Undo "),t.k0s(),t.j41(90,"button",43),t.bIt("click",function(){return i.redo()}),t.EFF(91," Redo "),t.nrm(92,"i",45),t.k0s(),t.j41(93,"button",46),t.bIt("click",function(){return i.saveState()}),t.EFF(94," Save "),t.nrm(95,"i",47),t.k0s()()(),t.j41(96,"div",48),t.nrm(97,"canvas",49),t.j41(98,"button",50),t.nrm(99,"i",51),t.k0s()()()()()),2&a&&(t.R7$(35),t.Y8G("ngIf",null==i.userMedia),t.R7$(13),t.R50("value",i.selectedFont),t.R7$(),t.Dyx(i.fonts),t.R7$(24),t.Y8G("formGroup",i.emailForm))},dependencies:[g.RG,g.rl,g.nJ,C.Ve,C.VO,A.wT,m.YN,m.qT,m.me,m.BC,m.cb,m.YS,m.X1,m.j4,m.JD,j.Wk,b.Hl,b.$z,_.Hu,S.fS,S.fg,E.g7,x.MD,x.bT],styles:["#canvas-box[_ngcontent-%COMP%]{position:relative;width:100%;box-sizing:border-box}#canvas-box[_ngcontent-%COMP%]   #fabricCanvas[_ngcontent-%COMP%]{border:2px solid #ccc;display:block;margin:0 auto;position:relative;box-sizing:border-box}#canvas-box[_ngcontent-%COMP%]   #del-item[_ngcontent-%COMP%]{position:absolute;top:20px;right:0;width:50px;aspect-ratio:1/1;border-radius:15px;background-color:red;cursor:pointer;border:none;color:#fff;transition:.3s;display:none}#canvas-box[_ngcontent-%COMP%]   #del-item[_ngcontent-%COMP%]:hover{box-shadow:1px 1px 5px red;transition:.3s}#action-btns[_ngcontent-%COMP%]{width:max-content;margin-left:auto;margin-bottom:20px}#action-btns[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:10px}#action-btns[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   #save-loader[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-wrap:wrap;gap:15px}.controls[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:14px;margin-right:10px}.icon-box[_ngcontent-%COMP%]{border:1px dashed #635BFF;border-radius:10px;padding:10px;margin-bottom:10px;transition:.3s;cursor:pointer}.icon-box[_ngcontent-%COMP%]:hover{box-shadow:0 0 5px #635bff;transition:.3s}#panels[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{display:none}#panels[_ngcontent-%COMP%]   .panel.show[_ngcontent-%COMP%]{display:block}#panels[_ngcontent-%COMP%]   .file-option[_ngcontent-%COMP%]{border:1px dashed #635BFF;border-radius:10px;padding:10px;margin-bottom:10px;transition:.3s}#panels[_ngcontent-%COMP%]   .file-option[_ngcontent-%COMP%]:hover{box-shadow:0 0 5px #635bff;transition:.3s}#panels[_ngcontent-%COMP%]   .file-option[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{text-align:center;width:100%;cursor:pointer}#panels[_ngcontent-%COMP%]   .file-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}#panels[_ngcontent-%COMP%]   #media[_ngcontent-%COMP%]{margin-bottom:10px}#panels[_ngcontent-%COMP%]   #media[_ngcontent-%COMP%]   div.col-lg-6[_ngcontent-%COMP%]{aspect-ratio:1/1}#panels[_ngcontent-%COMP%]   #media[_ngcontent-%COMP%]   div.col-lg-6[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%}#panels[_ngcontent-%COMP%]   #media[_ngcontent-%COMP%]   div.col-lg-6[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%}#panels[_ngcontent-%COMP%]   .shape[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border-radius:15px;border:1px dashed #635BFF;display:flex;padding:10px;cursor:pointer;transition:.3s;justify-content:center;align-items:center;flex-direction:column}#panels[_ngcontent-%COMP%]   .shape[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#635bff;font-size:150%}#panels[_ngcontent-%COMP%]   .shape[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:hover{box-shadow:0 0 5px #635bff;transition:.3s}"]})}}return s})()}}]);